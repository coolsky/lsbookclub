<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ì •ë³´ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background: white !important;
            }
            .page-break {
                page-break-after: always;
            }
        }
        .book-card {
            cursor: move;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .book-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        .book-card.drag-over {
            border-top: 3px solid #f97316;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="container mx-auto p-4 sm:p-6 max-w-4xl">
        
        <!-- Toast Container -->
        <div id="toastContainer"></div>

        <!-- Input Form Section -->
        <div id="inputSection" class="no-print bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-6">
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 mb-4">
                <div class="flex items-center gap-2">
                    <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-800">ë„ì„œ ì •ë³´ ê´€ë¦¬</h1>
                </div>
                <div class="flex gap-2 ml-auto">
                    <button id="importJsonBtn" 
                            class="text-sm bg-purple-600 text-white py-1 px-3 rounded hover:bg-purple-700 transition-colors"
                            title="JSON íŒŒì¼ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°">
                        ğŸ“¥ ê°€ì ¸ì˜¤ê¸°
                    </button>
                    <button id="exportJsonBtn" 
                            class="text-sm bg-indigo-600 text-white py-1 px-3 rounded hover:bg-indigo-700 transition-colors"
                            title="JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°">
                        ğŸ“¤ ë‚´ë³´ë‚´ê¸°
                    </button>
                </div>
            </div>

            <form id="bookForm" class="space-y-4" novalidate>
                <!-- URL ì…ë ¥ -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4 mb-4">
                    <label for="bookUrl" class="block text-sm font-semibold text-gray-700 mb-2">
                        ğŸ”— ì¸í„°ë„· ì„œì  URLì—ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì•Œë¼ë”˜)
                    </label>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="url" id="bookUrl" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                               placeholder="ì˜ˆ: https://aladin.co.kr/shop/wproduct.aspx?ItemId=..."
                               aria-label="ì•Œë¼ë”˜ ë„ì„œ URL">
                        <button type="button" id="fetchBtn"
                                class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors text-sm font-semibold whitespace-nowrap disabled:bg-blue-300 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                aria-label="ë„ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°">
                            <span id="fetchBtnText">ì •ë³´ ê°€ì ¸ì˜¤ê¸°</span>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">â€» ì•Œë¼ë”˜ ë„ì„œ í˜ì´ì§€ URLì„ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì •ë³´ë¥¼ ì±„ì›ë‹ˆë‹¤.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- ì±… ì œëª© -->
                    <div class="md:col-span-2">
                        <label for="bookTitle" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì±… ì œëª© <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="bookTitle" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: í´ë¦° ì½”ë“œ"
                               aria-required="true">
                        <p class="text-xs text-red-600 mt-1 hidden" id="bookTitleError">ì±… ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                    </div>

                    <!-- ë¶€ì œëª© -->
                    <div class="md:col-span-2">
                        <label for="bookSubtitle" class="block text-sm font-semibold text-gray-700 mb-1">
                            ë¶€ì œëª©
                        </label>
                        <input type="text" id="bookSubtitle" 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: ì• ìì¼ ì†Œí”„íŠ¸ì›¨ì–´ ì¥ì¸ ì •ì‹ ">
                    </div>

                    <!-- ì›ì œ -->
                    <div class="md:col-span-2">
                        <label for="bookOriginalTitle" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì›ì œ (ë²ˆì—­ì„œì¸ ê²½ìš°)
                        </label>
                        <input type="text" id="bookOriginalTitle" 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: Clean Code: A Handbook of Agile Software Craftsmanship">
                    </div>

                    <!-- ì €ì -->
                    <div>
                        <label for="bookAuthor" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì €ì <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="bookAuthor" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: ë¡œë²„íŠ¸ C. ë§ˆí‹´"
                               aria-required="true">
                        <p class="text-xs text-red-600 mt-1 hidden" id="bookAuthorError">ì €ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                    </div>

                    <!-- ì˜®ê¸´ì´ -->
                    <div>
                        <label for="bookTranslator" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì˜®ê¸´ì´ (ë²ˆì—­ì„œì¸ ê²½ìš°)
                        </label>
                        <input type="text" id="bookTranslator" 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: ì´í•´ì˜">
                    </div>

                    <!-- ì¶œíŒì‚¬ -->
                    <div>
                        <label for="bookPublisher" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì¶œíŒì‚¬
                        </label>
                        <input type="text" id="bookPublisher" 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: ì¸ì‚¬ì´íŠ¸">
                    </div>

                    <!-- ì¶œíŒì¼ -->
                    <div>
                        <label for="bookPublishDate" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì¶œíŒì¼/ì—°ë„
                        </label>
                        <input type="text" id="bookPublishDate" 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: 2024 ë˜ëŠ” 2024-03 ë˜ëŠ” 2024-03-15">
                    </div>

                    <!-- í˜ì´ì§€ ìˆ˜ -->
                    <div>
                        <label for="bookPages" class="block text-sm font-semibold text-gray-700 mb-1">
                            í˜ì´ì§€ ìˆ˜
                        </label>
                        <input type="number" id="bookPages" min="1"
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: 500">
                    </div>

                    <!-- ì œë³¸ ë°©ì‹ -->
                    <div>
                        <label for="bookBinding" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì œë³¸ ë°©ì‹
                        </label>
                        <input type="text" id="bookBinding"
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: ì–‘ì¥ë³¸, ë¬´ì„ ì œë³¸">
                    </div>

                    <!-- í¬ê¸° -->
                    <div>
                        <label for="bookSize" class="block text-sm font-semibold text-gray-700 mb-1">
                            í¬ê¸°
                        </label>
                        <input type="text" id="bookSize"
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: 152*223mm (A5ì‹ )">
                    </div>

                    <!-- ë¬´ê²Œ -->
                    <div>
                        <label for="bookWeight" class="block text-sm font-semibold text-gray-700 mb-1">
                            ë¬´ê²Œ
                        </label>
                        <input type="text" id="bookWeight"
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: 900g">
                    </div>

                    <!-- ISBN -->
                    <div>
                        <label for="bookIsbn" class="block text-sm font-semibold text-gray-700 mb-1">
                            ISBN
                        </label>
                        <input type="text" id="bookIsbn" 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: 978-89-6626-235-9">
                    </div>

                    <!-- ê°€ê²© -->
                    <div>
                        <label for="bookPrice" class="block text-sm font-semibold text-gray-700 mb-1">
                            ê°€ê²© (ì›)
                        </label>
                        <input type="number" id="bookPrice" min="0"
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: 33000">
                    </div>

                    <!-- ì±… ì„¤ëª… -->
                    <div class="md:col-span-2">
                        <label for="bookDescription" class="block text-sm font-semibold text-gray-700 mb-1">
                            ì±… ì„¤ëª…
                        </label>
                        <textarea id="bookDescription" rows="4"
                                  class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                                  placeholder="ì±…ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>

                    <!-- í‘œì§€ ì´ë¯¸ì§€ URL -->
                    <div class="md:col-span-2">
                        <label for="bookCoverUrl" class="block text-sm font-semibold text-gray-700 mb-1">
                            í‘œì§€ ì´ë¯¸ì§€ URL
                        </label>
                        <input type="url" id="bookCoverUrl" 
                               class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                               placeholder="ì˜ˆ: https://example.com/book-cover.jpg">
                    </div>
                </div>

                <!-- Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 pt-2">
                    <button type="submit" 
                            class="flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors font-semibold disabled:bg-blue-300"
                            aria-label="ë„ì„œ ëª©ë¡ì— ì¶”ê°€">
                        â• ì±… ì¶”ê°€
                    </button>
                    <button type="button" id="resetBtn"
                            class="bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600 transition-colors font-semibold"
                            aria-label="ì…ë ¥ í¼ ì´ˆê¸°í™”">
                        ğŸ”„ ì´ˆê¸°í™”
                    </button>
                </div>
            </form>

            <!-- Added Books List -->
            <div id="addedBooksSection" class="hidden mt-6 pt-6 border-t border-gray-200">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-3">
                    <h2 class="text-lg font-bold text-gray-800">
                        ì¶”ê°€ëœ ì±… ëª©ë¡ (<span id="bookCount">0</span>ê¶Œ)
                    </h2>
                    <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                        <input type="text" id="searchInput" 
                               class="flex-1 sm:flex-none sm:w-48 px-3 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="ğŸ” ê²€ìƒ‰..."
                               aria-label="ë„ì„œ ê²€ìƒ‰">
                        <button id="clearAllBtn" 
                                class="bg-red-600 text-white py-1 px-3 rounded hover:bg-red-700 transition-colors font-semibold text-sm"
                                title="ëª¨ë“  ì±… ì‚­ì œ"
                                aria-label="ëª¨ë“  ë„ì„œ ì‚­ì œ">
                            ğŸ—‘ï¸ ì „ì²´ì‚­ì œ
                        </button>
                        <button id="generateAllBtn" 
                                class="bg-orange-600 text-white py-1 px-3 rounded hover:bg-orange-700 transition-colors font-semibold text-sm"
                                aria-label="ì „ì²´ ë„ì„œ ì¶œë ¥">
                            ğŸ“– ì „ì²´ ì¶œë ¥
                        </button>
                    </div>
                </div>
                <div id="booksList" class="space-y-2 max-h-96 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Output Section -->
        <div id="outputSection" class="hidden">
            <!-- Action Buttons -->
            <div class="no-print flex flex-wrap gap-2 sm:gap-3 mb-4 items-center">
                <button id="printBtn" 
                        class="bg-blue-600 text-white py-2 px-3 sm:px-4 rounded hover:bg-blue-700 transition-colors text-sm flex items-center gap-2"
                        aria-label="ì¸ì‡„">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                    ì¸ì‡„
                </button>
                <button id="exportHtmlBtn" 
                        class="bg-green-600 text-white py-2 px-3 sm:px-4 rounded hover:bg-green-700 transition-colors text-sm flex items-center gap-2"
                        aria-label="HTML íŒŒì¼ë¡œ ì €ì¥">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    HTML ì €ì¥
                </button>
                <button id="editBtn" 
                        class="bg-gray-600 text-white py-2 px-3 sm:px-4 rounded hover:bg-gray-700 transition-colors text-sm flex items-center gap-2"
                        aria-label="í¸ì§‘ ëª¨ë“œë¡œ ëŒì•„ê°€ê¸°">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    í¸ì§‘
                </button>
                <span class="text-xs sm:text-sm text-gray-500 ml-auto hidden sm:inline">
                    ğŸ’¡ ì±…ì„ ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
                </span>
            </div>

            <!-- Books Display Container -->
            <div id="booksDisplayContainer" class="space-y-6" role="list" aria-label="ë„ì„œ ëª©ë¡"></div>

            <!-- Footer -->
            <div class="bg-white rounded-lg shadow-lg p-4 mt-6 text-center text-xs text-gray-500 no-print">
                ìƒì„±ì¼: <span id="generatedDate"></span>
            </div>
        </div>
    </div>

    <!-- Hidden file input for JSON import -->
    <input type="file" id="jsonFileInput" accept=".json" class="hidden" aria-hidden="true">

    <script>
        // ==================== Application Class ====================
        class BookManager {
            constructor() {
                this.books = [];
                this.draggedElement = null;
                this.draggedIndex = null;
                this.initializeElements();
                this.loadFromLocalStorage();
                this.attachEventListeners();
                this.updateBooksList();
            }

            initializeElements() {
                // Form elements
                this.bookForm = document.getElementById('bookForm');
                this.resetBtn = document.getElementById('resetBtn');
                this.generateAllBtn = document.getElementById('generateAllBtn');
                this.fetchBtn = document.getElementById('fetchBtn');
                this.printBtn = document.getElementById('printBtn');
                this.exportHtmlBtn = document.getElementById('exportHtmlBtn');
                this.exportJsonBtn = document.getElementById('exportJsonBtn');
                this.importJsonBtn = document.getElementById('importJsonBtn');
                this.editBtn = document.getElementById('editBtn');
                this.clearAllBtn = document.getElementById('clearAllBtn');
                this.searchInput = document.getElementById('searchInput');
                
                // Section elements
                this.inputSection = document.getElementById('inputSection');
                this.outputSection = document.getElementById('outputSection');
                this.addedBooksSection = document.getElementById('addedBooksSection');
                this.booksList = document.getElementById('booksList');
                this.bookCount = document.getElementById('bookCount');
                this.booksDisplayContainer = document.getElementById('booksDisplayContainer');
                
                // Input elements
                this.bookUrlInput = document.getElementById('bookUrl');
                this.jsonFileInput = document.getElementById('jsonFileInput');
                this.toastContainer = document.getElementById('toastContainer');
            }

            attachEventListeners() {
                this.bookForm.addEventListener('submit', (e) => this.handleFormSubmit(e));
                this.resetBtn.addEventListener('click', () => this.resetForm());
                this.generateAllBtn.addEventListener('click', () => this.generateAllOutput());
                this.fetchBtn.addEventListener('click', () => this.fetchBookInfo());
                this.printBtn.addEventListener('click', () => window.print());
                this.exportHtmlBtn.addEventListener('click', () => this.exportToHtml());
                this.exportJsonBtn.addEventListener('click', () => this.exportToJson());
                this.importJsonBtn.addEventListener('click', () => this.jsonFileInput.click());
                this.jsonFileInput.addEventListener('change', (e) => this.importFromJson(e));
                this.editBtn.addEventListener('click', () => this.showEditMode());
                this.clearAllBtn.addEventListener('click', () => this.clearAllBooks());
                this.searchInput.addEventListener('input', (e) => this.searchBooks(e.target.value));
            }

            // ==================== Toast Notifications ====================
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : 
                               type === 'error' ? 'bg-red-500' : 
                               type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
                
                toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 max-w-sm`;
                toast.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>${this.escapeHtml(message)}</span>
                `;
                
                this.toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            // ==================== LocalStorage ====================
            saveToLocalStorage() {
                try {
                    localStorage.setItem('bookManagerData', JSON.stringify(this.books));
                    return true;
                } catch (error) {
                    console.error('LocalStorage save error:', error);
                    this.showToast('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨', 'error');
                    return false;
                }
            }

            loadFromLocalStorage() {
                try {
                    const data = localStorage.getItem('bookManagerData');
                    if (data) {
                        this.books = JSON.parse(data);
                        this.showToast(`${this.books.length}ê¶Œì˜ ì±…ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'info');
                    }
                } catch (error) {
                    console.error('LocalStorage load error:', error);
                    this.showToast('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', 'error');
                }
            }

            // ==================== Form Validation ====================
            validateForm() {
                let isValid = true;
                const title = document.getElementById('bookTitle');
                const author = document.getElementById('bookAuthor');
                const titleError = document.getElementById('bookTitleError');
                const authorError = document.getElementById('bookAuthorError');

                // Reset errors
                titleError.classList.add('hidden');
                authorError.classList.add('hidden');
                title.classList.remove('border-red-500');
                author.classList.remove('border-red-500');

                if (!title.value.trim()) {
                    titleError.classList.remove('hidden');
                    title.classList.add('border-red-500');
                    isValid = false;
                }

                if (!author.value.trim()) {
                    authorError.classList.remove('hidden');
                    author.classList.add('border-red-500');
                    isValid = false;
                }

                return isValid;
            }

            // ==================== Form Handling ====================
            handleFormSubmit(e) {
                e.preventDefault();
                
                if (!this.validateForm()) {
                    this.showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                this.addBook();
            }

            addBook() {
                const bookData = {
                    id: Date.now(),
                    title: document.getElementById('bookTitle').value.trim(),
                    subtitle: document.getElementById('bookSubtitle').value.trim(),
                    originalTitle: document.getElementById('bookOriginalTitle').value.trim(),
                    author: document.getElementById('bookAuthor').value.trim(),
                    translator: document.getElementById('bookTranslator').value.trim(),
                    publisher: document.getElementById('bookPublisher').value.trim(),
                    publishDate: document.getElementById('bookPublishDate').value.trim(),
                    pages: document.getElementById('bookPages').value,
                    binding: document.getElementById('bookBinding').value.trim(),
                    size: document.getElementById('bookSize').value.trim(),
                    weight: document.getElementById('bookWeight').value.trim(),
                    isbn: document.getElementById('bookIsbn').value.trim(),
                    price: document.getElementById('bookPrice').value,
                    description: document.getElementById('bookDescription').value.trim(),
                    coverUrl: document.getElementById('bookCoverUrl').value.trim()
                };

                this.books.push(bookData);
                this.saveToLocalStorage();
                this.updateBooksList();
                this.resetForm();
                this.showToast('ì±…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }

            resetForm() {
                this.bookForm.reset();
                document.getElementById('bookTitleError').classList.add('hidden');
                document.getElementById('bookAuthorError').classList.add('hidden');
                document.getElementById('bookTitle').classList.remove('border-red-500');
                document.getElementById('bookAuthor').classList.remove('border-red-500');
            }

            // ==================== Book List Management ====================
            updateBooksList() {
                if (this.books.length === 0) {
                    this.addedBooksSection.classList.add('hidden');
                    return;
                }

                this.addedBooksSection.classList.remove('hidden');
                this.bookCount.textContent = this.books.length;
                this.booksList.innerHTML = '';

                this.books.forEach((book, index) => {
                    const bookItem = document.createElement('div');
                    bookItem.className = 'flex items-center justify-between bg-gray-50 p-3 rounded border border-gray-200 hover:bg-gray-100 transition-colors';
                    bookItem.innerHTML = `
                        <div class="flex-1 min-w-0">
                            <div class="font-semibold text-gray-800 truncate">${this.escapeHtml(book.title)}</div>
                            <div class="text-sm text-gray-600 truncate">${this.escapeHtml(book.author)}</div>
                        </div>
                        <button onclick="bookManager.removeBook(${index})" 
                                class="text-red-600 hover:text-red-800 font-semibold text-sm px-3 py-1 rounded hover:bg-red-50 transition-colors ml-2"
                                aria-label="${this.escapeHtml(book.title)} ì‚­ì œ">
                            ì‚­ì œ
                        </button>
                    `;
                    this.booksList.appendChild(bookItem);
                });
            }

            removeBook(index) {
                if (confirm('ì´ ì±…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.books.splice(index, 1);
                    this.saveToLocalStorage();
                    this.updateBooksList();
                    this.showToast('ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                }
            }

            clearAllBooks() {
                if (this.books.length === 0) {
                    this.showToast('ì‚­ì œí•  ì±…ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                if (confirm(`ì •ë§ë¡œ ëª¨ë“  ì±…(${this.books.length}ê¶Œ)ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                    this.books = [];
                    this.saveToLocalStorage();
                    this.updateBooksList();
                    this.showToast('ëª¨ë“  ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                }
            }

            searchBooks(query) {
                const items = this.booksList.querySelectorAll('div.flex');
                const searchTerm = query.toLowerCase().trim();

                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }

            // ==================== Fetch Book Info ====================
            async fetchBookInfo() {
                const url = this.bookUrlInput.value.trim();
                
                if (!url) {
                    this.showToast('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                if (!url.includes('aladin.co.kr')) {
                    this.showToast('ì•Œë¼ë”˜ ë„ì„œ í˜ì´ì§€ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                this.setFetchButtonLoading(true);

                try {
                    const bookInfo = await this.fetchWithRetry(url);
                    
                    if (bookInfo && bookInfo.title) {
                        this.fillFormWithBookInfo(bookInfo);
                        this.showToast('ì±… ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!', 'success');
                    } else {
                        throw new Error('ì±… ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('Fetch error:', error);
                    this.showToast(
                        'ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì•Œë¼ë”˜ í˜ì´ì§€ì—ì„œ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.',
                        'error'
                    );
                } finally {
                    this.setFetchButtonLoading(false);
                }
            }

            async fetchWithRetry(url, maxRetries = 2) {
                const proxies = [
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?'
                ];

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const proxyUrl = proxies[i % proxies.length] + encodeURIComponent(url);
                        const response = await fetch(proxyUrl);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }

                        const html = await response.text();
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        return this.extractAladinInfo(doc);
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed:`, error);
                        if (i === maxRetries - 1) throw error;
                    }
                }
            }

            extractAladinInfo(doc) {
                const info = {};

                try {
                    // ì œëª© ì¶”ì¶œ
                    const titleEl = doc.querySelector('meta[property="og:title"]') || 
                                   doc.querySelector('.book_title a') ||
                                   doc.querySelector('h1');
                    if (titleEl) {
                        const fullTitle = titleEl.getAttribute('content') || titleEl.textContent.trim();
                        info.title = fullTitle.split('|')[0].trim();
                    }

                    // ì €ì, ì¶œíŒì‚¬, ë‚ ì§œ ì¶”ì¶œ
                    const infoLi = doc.querySelector('li.Ere_sub2_title');
                    if (infoLi) {
                        const allLinks = infoLi.querySelectorAll('a.Ere_sub2_title');
                        
                        allLinks.forEach(link => {
                            const nextText = link.nextSibling ? link.nextSibling.textContent : '';
                            if (nextText.includes('(ì§€ì€ì´)')) {
                                info.author = link.textContent.trim();
                            } else if (nextText.includes('(ì˜®ê¸´ì´)')) {
                                info.translator = link.textContent.trim();
                            }
                        });
                        
                        const publisherLink = infoLi.querySelector('a[href*="PublisherSearch"]');
                        if (publisherLink) {
                            info.publisher = publisherLink.textContent.trim();
                        }
                        
                        const dateMatch = infoLi.textContent.match(/(\d{4})-(\d{2})-(\d{2})/);
                        if (dateMatch) {
                            info.publishDate = dateMatch[1];
                        }
                        
                        const originalTitleLink = infoLi.querySelector('a[href*="SearchTarget=Foreign"]');
                        if (originalTitleLink) {
                            info.originalTitle = originalTitleLink.textContent.replace(/^ì›ì œ\s*:\s*/i, '').trim();
                        }
                    }

                    // ê¸°ë³¸ ì •ë³´ ì¶”ì¶œ
                    const infoList = doc.querySelector('.conts_info_list1');
                    if (infoList) {
                        const listItems = infoList.querySelectorAll('li');
                        
                        listItems.forEach(li => {
                            const text = li.textContent.trim();
                            
                            if (text.match(/^\d+ìª½$/)) {
                                info.pages = text.replace('ìª½', '');
                            } else if (text.match(/^\d+\*\d+mm$/)) {
                                info.size = text;
                            } else if (text.match(/^\d+g$/)) {
                                info.weight = text;
                            } else if (text.includes('ISBN')) {
                                const isbnMatch = text.match(/ISBN\s*:\s*([0-9]+)/);
                                if (isbnMatch) {
                                    info.isbn = isbnMatch[1];
                                }
                            } else if (text.match(/(ì–‘ì¥ë³¸|ë¬´ì„ ì œë³¸|ë°˜ì–‘ì¥|í˜ì´í¼ë°±|í•˜ë“œì»¤ë²„)/)) {
                                info.binding = text;
                            }
                        });
                    }

                    // ê°€ê²© ì¶”ì¶œ
                    const priceListItems = doc.querySelectorAll('.info_list li');
                    priceListItems.forEach(li => {
                        const litem = li.querySelector('.Litem');
                        if (litem && litem.textContent.trim() === 'ì •ê°€') {
                            const ritem = li.querySelector('.Ritem');
                            if (ritem) {
                                const priceText = ritem.textContent.replace(/[^0-9]/g, '');
                                if (priceText) {
                                    info.price = priceText;
                                }
                            }
                        }
                    });

                    // ì„¤ëª… ì¶”ì¶œ
                    const descEl = doc.querySelector('.book_summary_wrap') ||
                                  doc.querySelector('meta[property="og:description"]');
                    if (descEl) {
                        let description = descEl.getAttribute('content') || descEl.textContent;
                        info.description = description.trim().substring(0, 500);
                    }

                    // í‘œì§€ ì´ë¯¸ì§€ ì¶”ì¶œ
                    const coverEl = doc.querySelector('meta[property="og:image"]') ||
                                   doc.querySelector('#CoverBigImage') ||
                                   doc.querySelector('img[id*="CoverImage"]');
                    if (coverEl) {
                        let coverUrl = coverEl.getAttribute('content') || coverEl.getAttribute('src');
                        if (coverUrl) {
                            if (coverUrl.startsWith('//')) {
                                info.coverUrl = 'https:' + coverUrl;
                            } else if (coverUrl.startsWith('http')) {
                                info.coverUrl = coverUrl;
                            }
                        }
                    }

                } catch (error) {
                    console.error('Parsing error:', error);
                }

                return info;
            }

            fillFormWithBookInfo(bookInfo) {
                const fields = {
                    bookTitle: bookInfo.title,
                    bookSubtitle: bookInfo.subtitle,
                    bookOriginalTitle: bookInfo.originalTitle,
                    bookAuthor: bookInfo.author,
                    bookTranslator: bookInfo.translator,
                    bookPublisher: bookInfo.publisher,
                    bookPublishDate: bookInfo.publishDate,
                    bookPages: bookInfo.pages,
                    bookBinding: bookInfo.binding,
                    bookSize: bookInfo.size,
                    bookWeight: bookInfo.weight,
                    bookIsbn: bookInfo.isbn,
                    bookPrice: bookInfo.price,
                    bookDescription: bookInfo.description,
                    bookCoverUrl: bookInfo.coverUrl
                };

                Object.entries(fields).forEach(([id, value]) => {
                    if (value) {
                        document.getElementById(id).value = value;
                    }
                });
            }

            setFetchButtonLoading(isLoading) {
                const btnText = document.getElementById('fetchBtnText');
                if (isLoading) {
                    this.fetchBtn.disabled = true;
                    btnText.textContent = 'ê°€ì ¸ì˜¤ëŠ” ì¤‘...';
                    this.fetchBtn.innerHTML = `
                        <div class="spinner"></div>
                        <span>ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span>
                    `;
                } else {
                    this.fetchBtn.disabled = false;
                    this.fetchBtn.innerHTML = '<span id="fetchBtnText">ì •ë³´ ê°€ì ¸ì˜¤ê¸°</span>';
                }
            }

            // ==================== Output Generation ====================
            generateAllOutput() {
                if (this.books.length === 0) {
                    this.showToast('ì¶œë ¥í•  ì±…ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                this.booksDisplayContainer.innerHTML = '';

                this.books.forEach((bookData, index) => {
                    const bookCard = this.createBookCard(bookData, index);
                    this.booksDisplayContainer.appendChild(bookCard);
                });

                const now = new Date();
                const generatedDate = now.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                document.getElementById('generatedDate').textContent = generatedDate;

                this.inputSection.classList.add('hidden');
                this.outputSection.classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            createBookCard(bookData, index) {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-lg overflow-hidden page-break book-card';
                card.draggable = true;
                card.dataset.index = index;
                card.setAttribute('role', 'listitem');

                card.addEventListener('dragstart', (e) => this.handleDragStart(e, card, index));
                card.addEventListener('dragend', (e) => this.handleDragEnd(e, card));
                card.addEventListener('dragover', (e) => this.handleDragOver(e, card));
                card.addEventListener('drop', (e) => this.handleDrop(e, card, index));
                card.addEventListener('dragleave', (e) => this.handleDragLeave(e, card));

                // wrapperëŠ” ì´ë¯¸ ìƒì„±í–ˆìœ¼ë¯€ë¡œ ë‚´ë¶€ ì»¨í…ì¸ ë§Œ í•„ìš”
                card.innerHTML = this.generateBookCardHTML(bookData, false);
                return card;
            }

            generateBookCardHTML(bookData, includeWrapper = true) {
                let html = '';
                
                // ìµœìƒìœ„ wrapper (export ì‹œ í•„ìš”)
                if (includeWrapper) {
                    html += '<div class="bg-white rounded-lg shadow-lg overflow-hidden page-break">\n';
                }
                
                html += `
                    <div class="bg-gradient-to-r from-orange-500 to-amber-500 p-4 text-white">
                        <h2 class="text-xl sm:text-2xl font-bold">${this.escapeHtml(bookData.title)}</h2>
                `;
                
                if (bookData.subtitle) {
                    html += `<p class="text-sm mt-1 opacity-90">${this.escapeHtml(bookData.subtitle)}</p>`;
                }
                
                if (bookData.originalTitle) {
                    html += `<p class="text-xs mt-1 opacity-75 italic">${this.escapeHtml(bookData.originalTitle)}</p>`;
                }
                
                html += `</div><div class="p-4"><div class="flex flex-col sm:flex-row gap-4">`;

                // Cover image
                html += `
                    <div class="flex-shrink-0 mx-auto sm:mx-0">
                        <div class="bg-gray-100 rounded shadow overflow-hidden w-32 h-44 flex items-center justify-center">
                `;
                
                if (bookData.coverUrl) {
                    html += `<img src="${this.escapeHtml(bookData.coverUrl)}" class="w-full h-full object-cover" alt="${this.escapeHtml(bookData.title)} í‘œì§€" loading="lazy">`;
                } else {
                    html += `
                        <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    `;
                }
                
                html += `</div></div><div class="flex-1 space-y-3"><div class="space-y-1 text-sm">`;

                const fields = [
                    { label: 'ì €ì', value: bookData.author },
                    { label: 'ì˜®ê¸´ì´', value: bookData.translator },
                    { label: 'ì¶œíŒì‚¬', value: bookData.publisher },
                    { label: 'ì¶œíŒì¼', value: bookData.publishDate },
                    { label: 'í˜ì´ì§€', value: bookData.pages, suffix: 'ìª½' },
                    { label: 'ì œë³¸', value: bookData.binding },
                    { label: 'í¬ê¸°', value: bookData.size },
                    { label: 'ë¬´ê²Œ', value: bookData.weight },
                    { label: 'ISBN', value: bookData.isbn }
                ];

                fields.forEach(field => {
                    if (field.value) {
                        html += `
                            <div>
                                <span class="text-gray-500">${field.label}:</span>
                                <span class="text-gray-800 font-semibold ml-2">${this.escapeHtml(field.value)}${field.suffix || ''}</span>
                            </div>
                        `;
                    }
                });

                if (bookData.price) {
                    const formattedPrice = Number(bookData.price).toLocaleString('ko-KR');
                    html += `
                        <div>
                            <span class="text-gray-500">ê°€ê²©:</span>
                            <span class="text-orange-600 font-bold ml-2 text-base">${formattedPrice}ì›</span>
                        </div>
                    `;
                }

                html += `</div>`;

                if (bookData.description) {
                    html += `
                        <div class="pt-2 border-t border-gray-200">
                            <p class="text-gray-700 text-sm leading-relaxed whitespace-pre-line">${this.escapeHtml(bookData.description)}</p>
                        </div>
                    `;
                }

                html += `</div></div></div>`;
                
                // ìµœìƒìœ„ wrapper ë‹«ê¸°
                if (includeWrapper) {
                    html += '\n</div>';
                }
                
                return html;
            }

            // ==================== Drag and Drop ====================
            handleDragStart(e, card, index) {
                this.draggedElement = card;
                this.draggedIndex = index;
                card.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            }

            handleDragEnd(e, card) {
                card.classList.remove('dragging');
                document.querySelectorAll('.book-card').forEach(c => c.classList.remove('drag-over'));
            }

            handleDragOver(e, card) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const targetIndex = parseInt(card.dataset.index);
                if (this.draggedIndex !== targetIndex) {
                    card.classList.add('drag-over');
                }
            }

            handleDragLeave(e, card) {
                card.classList.remove('drag-over');
            }

            handleDrop(e, card, targetIndex) {
                e.stopPropagation();
                
                if (this.draggedIndex !== targetIndex && this.draggedIndex !== null) {
                    const draggedBook = this.books[this.draggedIndex];
                    this.books.splice(this.draggedIndex, 1);
                    this.books.splice(targetIndex, 0, draggedBook);
                    
                    this.saveToLocalStorage();
                    this.regenerateOutput();
                    this.showToast('ìˆœì„œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }
                
                card.classList.remove('drag-over');
            }

            regenerateOutput() {
                this.booksDisplayContainer.innerHTML = '';
                this.books.forEach((bookData, index) => {
                    const bookCard = this.createBookCard(bookData, index);
                    this.booksDisplayContainer.appendChild(bookCard);
                });
            }

            showEditMode() {
                this.outputSection.classList.add('hidden');
                this.inputSection.classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // ==================== Export Functions ====================
            exportToHtml() {
                if (this.books.length === 0) {
                    this.showToast('ì¶œë ¥í•  ì±…ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                const now = new Date();
                const generatedDate = now.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                let htmlContent = '<!DOCTYPE html>\n';
                htmlContent += '<html lang="ko">\n';
                htmlContent += '<head>\n';
                htmlContent += '    <meta charset="UTF-8">\n';
                htmlContent += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
                htmlContent += '    <title>ë„ì„œ ëª©ë¡ - ' + generatedDate + '</title>\n';
                htmlContent += '    <style>\n';
                htmlContent += `
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f9fafb;
            min-height: 100vh;
            padding: 1.5rem;
        }
        .container { 
            max-width: 56rem; 
            margin: 0 auto; 
        }
        .space-y-6 > * + * { 
            margin-top: 1.5rem; 
        }
        .book-card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        .book-header {
            background: linear-gradient(to right, #f97316, #f59e0b);
            padding: 1rem;
            color: white;
        }
        .book-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        .book-subtitle {
            font-size: 0.875rem;
            margin-top: 0.25rem;
            opacity: 0.9;
        }
        .book-original-title {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            opacity: 0.75;
            font-style: italic;
        }
        .book-content {
            padding: 1rem;
        }
        .book-layout {
            display: flex;
            gap: 1rem;
        }
        .book-cover-container {
            flex-shrink: 0;
        }
        .book-cover {
            width: 8rem;
            height: 11rem;
            background-color: #f3f4f6;
            border-radius: 0.25rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e5e7eb;
        }
        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .book-cover-placeholder {
            padding: 1rem;
            text-align: center;
            color: #6b7280;
            font-size: 0.75rem;
            line-height: 1.4;
            word-break: keep-all;
        }
        .book-cover-icon {
            width: 3rem;
            height: 3rem;
            color: #d1d5db;
            margin-bottom: 0.5rem;
        }
        .book-details {
            flex: 1;
        }
        .book-info-list {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .book-info-item {
            font-size: 0.875rem;
        }
        .book-info-label {
            color: #6b7280;
        }
        .book-info-value {
            color: #1f2937;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        .book-description {
            margin-top: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }
        .book-description p {
            color: #374151;
            font-size: 0.875rem;
            line-height: 1.625;
            white-space: pre-line;
        }
        .footer {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-top: 1.5rem;
            text-align: center;
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        @media print {
            body { background: white !important; }
            .book-card { page-break-after: always; }
        }
        
        @media (max-width: 640px) {
            body { padding: 1rem; }
            .book-layout { flex-direction: column; }
            .book-cover-container { margin: 0 auto; }
            .book-title { font-size: 1.25rem; }
        }
`;
                htmlContent += '    </style>\n';
                htmlContent += '</head>\n';
                htmlContent += '<body>\n';
                htmlContent += '    <div class="container">\n';
                htmlContent += '        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->\n';
                htmlContent += '        <div style="background-color: #eff6ff; border-left: 4px solid #3b82f6; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.5rem;">\n';
                htmlContent += '            <p style="font-size: 0.875rem; color: #1e40af; margin: 0;">\n';
                htmlContent += '                <strong>ğŸ“± ì•ˆë‚´:</strong> ì¹´ì¹´ì˜¤í†¡ì´ë‚˜ ì¼ë¶€ ì•±ì—ì„œëŠ” ì™¸ë¶€ ì´ë¯¸ì§€ê°€ ì°¨ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ê°€ ë³´ì´ì§€ ì•Šìœ¼ë©´ ì¼ë°˜ ë¸Œë¼ìš°ì €(í¬ë¡¬, ì‚¬íŒŒë¦¬ ë“±)ë¡œ ì—´ì–´ì£¼ì„¸ìš”.\n';
                htmlContent += '            </p>\n';
                htmlContent += '        </div>\n';
                htmlContent += '        <div class="space-y-6">\n';

                this.books.forEach(bookData => {
                    htmlContent += this.generateStandaloneBookCardHTML(bookData);
                });

                htmlContent += '        </div>\n';
                htmlContent += '        <div class="footer">\n';
                htmlContent += '            ìƒì„±ì¼: ' + generatedDate + '\n';
                htmlContent += '        </div>\n';
                htmlContent += '    </div>\n';
                htmlContent += '</body>\n';
                htmlContent += '</html>';

                this.downloadFile(htmlContent, 'text/html', 'ë„ì„œëª©ë¡', 'html');
                this.showToast('HTML íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }

            generateStandaloneBookCardHTML(bookData) {
                let html = '<div class="book-card">\n';
                
                // Header
                html += '    <div class="book-header">\n';
                html += '        <h2 class="book-title">' + this.escapeHtml(bookData.title) + '</h2>\n';
                
                if (bookData.subtitle) {
                    html += '        <p class="book-subtitle">' + this.escapeHtml(bookData.subtitle) + '</p>\n';
                }
                
                if (bookData.originalTitle) {
                    html += '        <p class="book-original-title">' + this.escapeHtml(bookData.originalTitle) + '</p>\n';
                }
                
                html += '    </div>\n';
                
                // Content
                html += '    <div class="book-content">\n';
                html += '        <div class="book-layout">\n';
                
                // Cover
                html += '            <div class="book-cover-container">\n';
                html += '                <div class="book-cover">\n';
                
                if (bookData.coverUrl) {
                    html += '                    <img src="' + this.escapeHtml(bookData.coverUrl) + '" alt="' + this.escapeHtml(bookData.title) + ' í‘œì§€" onerror="this.style.display=\'none\'; this.parentElement.innerHTML=\'<div class=\\\'book-cover-placeholder\\\'><svg class=\\\'book-cover-icon\\\' fill=\\\'none\\\' stroke=\\\'currentColor\\\' viewBox=\\\'0 0 24 24\\\'><path stroke-linecap=\\\'round\\\' stroke-linejoin=\\\'round\\\' stroke-width=\\\'2\\\' d=\\\'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253\\\'></path></svg><div>' + this.escapeHtml(bookData.title) + '</div></div>\';">\n';
                } else {
                    html += '                    <div class="book-cover-placeholder">\n';
                    html += '                        <svg class="book-cover-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n';
                    html += '                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>\n';
                    html += '                        </svg>\n';
                    html += '                        <div>' + this.escapeHtml(bookData.title) + '</div>\n';
                    html += '                    </div>\n';
                }
                
                html += '                </div>\n';
                html += '            </div>\n';
                
                // Details
                html += '            <div class="book-details">\n';
                html += '                <div class="book-info-list">\n';
                
                const fields = [
                    { label: 'ì €ì', value: bookData.author },
                    { label: 'ì˜®ê¸´ì´', value: bookData.translator },
                    { label: 'ì¶œíŒì‚¬', value: bookData.publisher },
                    { label: 'ì¶œíŒì¼', value: bookData.publishDate },
                    { label: 'í˜ì´ì§€', value: bookData.pages, suffix: 'ìª½' },
                    { label: 'ì œë³¸', value: bookData.binding },
                    { label: 'í¬ê¸°', value: bookData.size },
                    { label: 'ë¬´ê²Œ', value: bookData.weight },
                    { label: 'ISBN', value: bookData.isbn }
                ];

                fields.forEach(field => {
                    if (field.value) {
                        html += '                    <div class="book-info-item">\n';
                        html += '                        <span class="book-info-label">' + field.label + ':</span>\n';
                        html += '                        <span class="book-info-value">' + this.escapeHtml(field.value) + (field.suffix || '') + '</span>\n';
                        html += '                    </div>\n';
                    }
                });

                if (bookData.price) {
                    const formattedPrice = Number(bookData.price).toLocaleString('ko-KR');
                    html += '                    <div class="book-info-item">\n';
                    html += '                        <span class="book-info-label">ê°€ê²©:</span>\n';
                    html += '                        <span class="book-info-value">' + formattedPrice + 'ì›</span>\n';
                    html += '                    </div>\n';
                }
                
                html += '                </div>\n';
                
                if (bookData.description) {
                    html += '                <div class="book-description">\n';
                    html += '                    <p>' + this.escapeHtml(bookData.description) + '</p>\n';
                    html += '                </div>\n';
                }
                
                html += '            </div>\n';
                html += '        </div>\n';
                html += '    </div>\n';
                html += '</div>\n';
                
                return html;
            }

            exportToJson() {
                if (this.books.length === 0) {
                    this.showToast('ë‚´ë³´ë‚¼ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    books: this.books
                };

                const jsonContent = JSON.stringify(data, null, 2);
                this.downloadFile(jsonContent, 'application/json', 'ë„ì„œë°ì´í„°', 'json');
                this.showToast(`${this.books.length}ê¶Œì˜ ì±… ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.`, 'success');
            }

            importFromJson(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (!data.books || !Array.isArray(data.books)) {
                            throw new Error('Invalid JSON format');
                        }

                        if (this.books.length > 0) {
                            if (!confirm('ê¸°ì¡´ ë°ì´í„°ì— ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì·¨ì†Œ ì‹œ ê¸°ì¡´ ë°ì´í„° ë®ì–´ì“°ê¸°)')) {
                                this.books = data.books;
                            } else {
                                this.books = [...this.books, ...data.books];
                            }
                        } else {
                            this.books = data.books;
                        }

                        this.saveToLocalStorage();
                        this.updateBooksList();
                        this.showToast(`${data.books.length}ê¶Œì˜ ì±…ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
                    } catch (error) {
                        console.error('Import error:', error);
                        this.showToast('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                };
                reader.readAsText(file);
                
                // Reset file input
                event.target.value = '';
            }

            downloadFile(content, mimeType, baseName, extension) {
                const blob = new Blob([content], { type: `${mimeType};charset=utf-8` });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const now = new Date();
                const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;
                
                a.href = url;
                a.download = `${baseName}_${dateStr}.${extension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // ==================== Utility Functions ====================
            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize the application
        let bookManager;
        document.addEventListener('DOMContentLoaded', () => {
            bookManager = new BookManager();
        });
    </script>
</body>
</html>
